From e84a51cebaf0d6cd82b926d81af74bcad53e2ae0 Mon Sep 17 00:00:00 2001
From: Sang Ik Lee <sang.ik.lee@intel.com>
Date: Wed, 13 Feb 2019 14:24:37 -0800
Subject: [PATCH] Patch for nGraph.

---
 cmake/OpenMP.cmake |  2 +-
 src/CMakeLists.txt | 10 ++++++++--
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/cmake/OpenMP.cmake b/cmake/OpenMP.cmake
index 2e9aa736..7d370c92 100644
--- a/cmake/OpenMP.cmake
+++ b/cmake/OpenMP.cmake
@@ -30,7 +30,7 @@ if (APPLE AND CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
     # But we still want to build the library.
     set(_omp_severity "WARNING")
 else()
-    set(_omp_severity "FATAL_ERROR")
+    set(_omp_severity "WARNING")
 endif()
 
 
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 83ed499a..05721370 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -98,10 +98,16 @@ else()
     set(CTESTCONFIG_PATH "${CTESTCONFIG_PATH}\;${CMAKE_CURRENT_BINARY_DIR}" PARENT_SCOPE)
 endif()
 target_link_libraries(${TARGET_NAME} ${${TARGET_NAME}_LINKER_LIBS} ${EXTRA_LIBS})
+if(NOT APPLE)
+    set_property(TARGET ${TARGET_NAME} APPEND_STRING PROPERTY LINK_FLAGS " -Wl,--rpath,$ORIGIN")
+    set_target_properties(${TARGET_NAME} PROPERTIES INSTALL_RPATH "$ORIGIN")
+endif()
 set_property(TARGET ${TARGET_NAME} PROPERTY CXX_STANDARD 11)
 set_property(TARGET ${TARGET_NAME} PROPERTY CXX_STANDARD_REQUIRED ON)
-set_property(TARGET ${TARGET_NAME} PROPERTY VERSION "${PROJECT_VERSION}.0")
-set_property(TARGET ${TARGET_NAME} PROPERTY SOVERSION "0")
+if(MKLDNN_LIB_VERSIONING_ENABLE)
+    set_property(TARGET ${TARGET_NAME} PROPERTY VERSION "${PROJECT_VERSION}.0")
+    set_property(TARGET ${TARGET_NAME} PROPERTY SOVERSION "0")
+endif()
 
 if(MINGW)
     # We need to install *.dll into bin/ and *.a into lib/. 
-- 
2.20.1

